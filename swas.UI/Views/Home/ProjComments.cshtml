@model swas.DAL.Models.StkComment
@using swas.BAL.DTO
@using swas.BAL.Helpers
@using swas.DAL.Models


@inject IHttpContextAccessor HttpContextAccessor
@{

    ViewData["Title"] = "Proj Comments";
    int sno = 0;
    Login Logins = SessionHelper.GetObjectFromJson<Login>(HttpContextAccessor.HttpContext.Session, "User");

}
@{
    var projdetails = ViewBag.projdetails;


    var proj = ViewBag.Projects;
    ViewBag.ProjDetl = ViewBag.ProjDetl;

    int psmid = 0;
    int stkid = 0;

}



<style>
    .new-proj-table {
        width: 100%;
        height: auto;
        border-collapse: collapse;
        margin-top: 10px;
    }

        .new-proj-table td {
            border: 0px solid #ddd;
            padding: 8px;
            text-align: left;
            color: black;
        }

    .long-text {
        max-width: 300px;
        overflow: auto;
        text-overflow: inherit;
        white-space: nowrap;
    }

    .blue-button {
        /* Add your styles for the black button here */
        background-color: #044C92; /* Example background color */
        border: 1px solid #000;
        color: #fff;
        width: 41px;
        height: 23px;
        /* Add other styles as needed */
    }

    .green-button {
        /* Styles for the green button */
        background-color: #4CAF50; /* Example green color */
        /* Add other styles as needed */
        width: 41px;
        height: 23px;
    }

    .yellow-button {
        /* Styles for the yellow button */
        background-color: #FFC107; /* Example yellow color */
        width: 41px;
        height: 23px;
        /* Add other styles as needed */
    }

    .red-button {
        /* Styles for the red button */
        background-color: #F44336; /* Example red color */
        /* Add other styles as needed */
    }

    /* Add 3D effect styles for the buttons */
    .table-button {
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Example shadow effect */
        transition: transform 0.3s;
    }

    .table-butgreen {
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Example shadow effect */
        transition: transform 0.3s;
    }

    .table-button:hover {
        transform: translateY(-3px);
        background-color: blue; /* Example hover effect for 3D appearance */
    }

    .required-indicator {
        color: red;
        font-size: 18px;
    }



    .modal-content {
        height: 800px !important;
        width: 1000px !important;
    }

    .underline-h5 {
        padding: 0.5rem;
        width: 100%;
        margin: 0 auto; /* Center the box */
        text-align: center;
        border-color: #03c1fc;
        /*box-shadow: 2px 6px 5px -3px #062b50;*/
        background-color: #0cafff;
        color: white;
        font-family: Arial;
        font-size: 15px;
        margin-bottom: 0.5rem;
        height: -1px;
    }


    .underline-h7 {
        background: #0793f7;
        margin-bottom: 0px;
        text-align: left;
        color: white;
        font-size: 14px;
        height: 35px;
        padding-top: 4px;
        font-weight: 100;
    }

    .row {
        display: flex; /* Make the row a flex container */
        align-items: stretch; /* Align child elements to have equal height */
    }

    .col-lg-6 {
        flex: 1; /* Distribute the available space equally between the two columns */
        margin-right: 10px; /* Add some space between the columns (adjust as needed) */
    }


    .cancel-button {
        background-color: #F44336; /* Red color */
        border: none;
        color: #000; /* Black text color */
        padding: 5px 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Shadow effect */
        transition: transform 0.3s;
    }

        .cancel-button:hover {
            transform: translateY(-3px);
            background-color: darkred; /* Darker red color on hover */
        }


    .projecthead {
        background: #044c92;
        margin-bottom: 0px;
        text-align: center;
        margin-top: -14px;
        margin-left: -15px;
        width: 104%;
        color: white;
        height: 35px;
        padding-top: 4px;
        font-family: arial, sans-serif;
        border-collapse: collapse;
        font-weight: bold;
    }

    .blog-comment-container {
        width: 60%;
        margin: 20px auto;
    }

    .comment-box {
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        margin-left: 6px;
        margin-right: 6px;
        margin-top: 6px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .comment-meta {
        font-size: 14px;
        color: #777777;
    }

    .comment-content {
        font-size: 16px;
        line-height: 1.6;
    }

    .pdf-link img {
        width: 24px;
        height: 24px;
    }


    .new-proj-table {
        width: 100%;
    }

    .card {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .custom-scrollbar {
        -webkit-overflow-scrolling: auto;
        padding-right: 15px;
    }

    .projecthead {
        background-color: #3498db;
        color: #ffffff;
        padding: 10px;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
    }

</style>


<div id="MyDatacontainer" class="col-lg-12 col-md-12 col-sm-12">
</div>


<div class="row">


    <div id="AddStatusDetails" class="col-lg-12 col-md-12 col-sm-12">
        <h5 class="text-center mb-4 underline-h5" style="text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); position: relative;">
            <span>
                Add Comments <button type="button" class="btn btn-danger cancel-button" style="width:15px; position: absolute; top: 0; right: 0;" id="CancelUpdate">X</button>
            </span>
        </h5>

        <div class="row">

            <!-- Proj Details -->
            <div class="col-12 col-lg-12 col-xl-4 d-flex" style="border-radius: 15px;margin-top: -17px;">
                <div class="card radius-14 w-100">
                    <div class="card-body">
                        <div class="projecthead" id="projectDetails">
                            Proj Details <img src="~/assets/images/icons/pdfimg.png" onclick="PrintDiv()" alt="Pdf Download" width="35" height="25">
                        </div>
                        <table class="new-proj-table">
                        </table>

                    </div>
                </div>
            </div>

            <!-- Sponsor Details -->
            <div class="col-12 col-lg-12 col-xl-4 d-flex" style="border-radius: 15px;margin-top: -17px;">
                <div class="card radius-14 w-100">
                    <div class="card-body">
                        <div class="projecthead" id="ProjDetails1">
                            Tech Details
                        </div>
                        <table class="new-proj-table" style="width: 100%; height:150px;">
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tech Details -->
            <div class="col-12 col-lg-12 col-xl-4 d-flex" style="border-radius: 15px;margin-top: -17px;">
                <div class="card radius-14 w-100">
                    <div class="card-body">
                        <div class="projecthead" id="ProjDetails2">
                            Other Details
                        </div>
                        <table class="new-proj-table">
                        </table>
                    </div>
                </div>
            </div>



            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="card radius-12" style="height: 550px; overflow-y: auto;">
                    <div class="text-with-icon underline-h7">
                        <span style="font-size: 20px;">&#128172;</span>
                        <h7 class="text-center mb-4 underline-h7" style="text-align:left; text-decoration-color:revert; color:antiquewhite">
                            Add Comments for Project
                        </h7>
                    </div>

                    <form class="form-group" asp-action="UpdateStatus" id="StatusUpdateForm" enctype="multipart/form-data">
                        <div class="container mt-1">
                            <div class="row justify-content-center">
                                <div class="col-md-10 form-container">
                                    @*<h6 class="text-center mb-4" id="stakeholderInfo">*@

                                    <div class="col-md-auto">
                                        <input asp-for="StakeHolderId" hidden="hidden" style="width: 100%; height: 365px;" class="form-control" rows="4">

                                    </div>

                                    <div class="col-md-auto">
                                        <input asp-for="ProjId" id="ProjtextId" hidden="hidden" style="width: 100%; height: 365px;" class="form-control" rows="4">

                                    </div>

                                    <div class="col-md-auto">
                                        <input asp-for="PsmId" hidden="hidden" id="PsmToProj" style="width: 100%; height: 365px;" class="form-control" rows="4">

                                    </div>

                                    <div class="needs-validation" novalidate>
                                        <div class="row">
                                            <div>
                                                <!-- First Part: Comments -->
                                                <div class="form-group">
                                                    <label asp-for="Comments"><b>Comment</b> <span class="required-indicator">*</span></label>
                                                    <textarea asp-for="Comments" style="width: 100%; height: 240px;" class="form-control" rows="4" required oninput="ValInData(this)"></textarea>
                                                    <div class="invalid-feedback">Please provide the Comments</div>
                                                    <span asp-validation-for="Comments" class="text-danger"></span> <!-- Validation message -->
                                                </div>
                                                <div class="form-group">
                                                    
                                                        @if (Logins.unitid == 1)
                                                        {
                                                          <label asp-for="StkStatusId" class="control-label"><b>Status</b> <span class="text-danger"><font style="color:red;"><b>*</b></font></span></label>
                                                         <select asp-for="StkStatusId" class="form-control" id="ddlStatus" onchange="handleStatusChange()">
                                                            <option value="">Select a Status</option>

                                                            @foreach (var status in ViewBag.Stk_StatusForDte)
                                                            {
                                                                <option value="@status.StkStatusId">@status.Status</option>
                                                            }
                                                        </select>
                                                        }
                                                        else
                                                        {
                                                           
                                                        <label asp-for="StkStatusId" class="control-label"><b>Status</b> <span class="text-danger"><font style="color:red;"><b>*</b></font></span></label>
                                                        <select asp-for="StkStatusId" class="form-control" id="ddlStatus" onchange="handleStatusChange()">
                                                            <option value="">Select a Status</option>

                                                            @foreach (var status in ViewBag.Stk_Status)
                                                            {
                                                            <option value="@status.StkStatusId">@status.Status</option>
                                                            }
                                                        </select>

                                                        }
                                                    
                                                    <div class="invalid-feedback">Please select a Status.</div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="pdfFile"><b>Upload PDF</b></label>
                                                <input type="file" id="uploadfile" name="uploadfile" accept=".pdf" class="form-control" />
                                                <div class="invalid-feedback">Please upload a PDF file.</div>
                                            </div>
                                            <div class="form-group text-left    ">
                                                <button type="submit" class="btn btn-primary" id="StatusUpdate" >Update</button>

                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>


            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="card radius-12" style="height: 550px; overflow-y: auto;">
                    <div class="text-with-icon underline-h7">
                        <span style="font-size: 20px;">&#128172;</span>
                        <h7 class="text-center mb-4 underline-h7" style="text-align:left; text-decoration-color:revert; color:antiquewhite">
                            Comments With Status
                        </h7>
                    </div>
                    <!-- Chat-like display for comments -->
                    <div class="card radius-12" style="overflow-y: auto;">

                        <div class="chat-messages" id="ChatBox">
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>


    @* read only section *@


    <div id="AddStatusDetReadonly" class="col-lg-12 col-md-12 col-sm-12">
        <h5 class="text-center mb-4 underline-h5" style="text-align: center; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); position: relative;">
            <span>
                Add Comments <button type="button" class="btn btn-danger cancel-button" style="width:15px; position: absolute; top: 0; right: 0;" id="CancelUpdate1">X</button>
            </span>
        </h5>

        <div class="row">
            <!-- Proj Details -->
            <div class="col-12 col-lg-12 col-xl-4 d-flex" style="border-radius: 15px;margin-top: -17px;">
                <div class="card radius-14 w-100">
                    <div class="card-body">
                        <div class="projecthead" id="projectreadDetails">
                            Proj Details
                        </div>
                        <table class="new-proj-table">
                        </table>

                    </div>
                </div>
            </div>

            <!-- Sponsor Details -->
            <div class="col-12 col-lg-12 col-xl-4 d-flex" style="border-radius: 15px;margin-top: -17px;">
                <div class="card radius-14 w-100">
                    <div class="card-body">
                        <div class="projecthead" id="ProjreadDetails1">
                            Tech Details
                        </div>
                        <table class="new-proj-table" style="width: 100%; height:150px;">
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tech Details -->
            <div class="col-12 col-lg-12 col-xl-4 d-flex" style="border-radius: 15px;margin-top: -17px;">
                <div class="card radius-14 w-100">
                    <div class="card-body">
                        <div class="projecthead" id="ProjreadDetails2">
                            Other Details
                        </div>
                        <table class="new-proj-table">
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="card radius-12" style="height: 550px; overflow-y: auto;">
                    <div class="text-with-icon underline-h7">
                        <span style="font-size: 20px;">&#128172;</span>
                        <h7 class="text-center mb-4 underline-h7" style="text-align:left; text-decoration-color:revert; color:antiquewhite">
                            Add Comments for Project
                        </h7>
                    </div>

                    <form class="form-group" asp-action="UpdateStatus" id="StatusUpdateForm" enctype="multipart/form-data">
                        <div class="container mt-1">
                            <div class="row justify-content-center">
                                <div class="col-md-10 form-container">
                                    @*<h6 class="text-center mb-4" id="stakeholderInfo">*@

                                    <div class="col-md-auto">
                                        <input asp-for="StakeHolderId" hidden="hidden" style="width: 100%; height: 365px;" class="form-control" rows="4">

                                    </div>

                                    <div class="col-md-auto">
                                        <input asp-for="ProjId" hidden="hidden" style="width: 100%; height: 365px;" class="form-control" rows="4">

                                    </div>

                                    <div class="col-md-auto">
                                        <input asp-for="PsmId" hidden="hidden" style="width: 100%; height: 365px;" class="form-control" rows="4">

                                    </div>

                                    <div class="needs-validation" novalidate>
                                        <div class="row">
                                            <div>
                                                <!-- First Part: Comments -->
                                                <div class="form-group">
                                                    @******** PROJECT ACCEPTED  *********@
                                                    <label asp-for="Comments" ><b>Comment</b> <span class="required-indicator">*</span></label>
                                                    <textarea asp-for="Comments"  style="width: 100%; height: 240px;" class="form-control" rows="4" required oninput="ValInDataSSS(this)"></textarea>
                                                    <div class="invalid-feedback">Please provide the Comments</div>
                                                    <span asp-validation-for="Comments"  class="text-danger"></span> <!-- Validation message -->
                                                </div>
                                                <div class="form-group">
                                                    <label asp-for="StkStatusId"  class="control-label"><b>Status</b> <span class="text-danger"><font style="color:red;"><b>*</b></font></span></label>
                                                    <select asp-for="StkStatusId" class="form-control" id="ddlStatus" onchange="handleStatusChange()">
                                                        <option value="">Select a Status</option>
                                                        @if (Logins.unitid == 1)
                                                        {
                                                            foreach (var status in ViewBag.Stk_StatusForDte)
                                                            {
                                                                <option value="@status.StkStatusId">@status.Status</option>
                                                            }
                                                        }
                                                        else
                                                        {
                                                            foreach (var status in ViewBag.Stk_Status)
                                                            {
                                                                <option value="@status.StkStatusId">@status.Status</option>
                                                            }
                                                        }
                                                    </select>
                                                    <div class="invalid-feedback">Please select a Status.</div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="pdfFile" ><b>Upload PDF</b></label>
                                                <input type="file" id="uploadfile"  name="uploadfile" accept=".pdf" class="form-control" readonly />
                                                <div class="invalid-feedback">Please upload a PDF file.</div>
                                            </div>
                                            <div class="form-group text-left    ">
                                                <button type="submit" class="btn btn-primary" readonly  >Update</button>
                                                <button  type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>


            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="card radius-12" style="height: 550px; overflow-y: auto;">
                    <div class="text-with-icon underline-h7">
                        <span style="font-size: 20px;">&#128172;</span>
                        <h7 class="text-center mb-4 underline-h7" style="text-align:left; text-decoration-color:revert; color:antiquewhite">
                            Comments With Status
                        </h7>
                    </div>
                    <!-- Chat-like display for comments -->
                    <div class="card radius-12" style="overflow-y: auto;">

                        <div class="chat-messages" id="ChatBoxreadonly">
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>

</div>


@* end read only section *@




<!----Table for Stakeholder Status Change----->

<div id="IndexTableContainer" class="card-body">
    <div class="card radius-10 w-100">
        <div class="card-body">

            <table id="IndexTable" class="table table-striped table-bordered">
                <!-- Table header -->
                <thead>
                    <tr>
                        <th>Ser No</th>
                        @*  <th>Att</th> *@
                        <th>Project</th>
                        <th>Stakeholder</th>
                        <th>Held With</th>
                        <th> Comment</th>
                        <th>Updated on</th>



                        @foreach (var project in ViewBag.stakeholders)
                        {
                            if (Logins.Unit == @project.UnitName)
                            {
                                <th>Status</th>
                                <th>@project.UnitName</th>
                            }
                        }


                    </tr>
                </thead>

                <tbody>
                    @foreach (var project in ViewBag.projects)
                    {
                        <tr>
                            <td>
                                @{
                                    sno++;
                                }
                                @sno
                            </td>
                            @*  <td>
                        @if (project.AttCnt > 0)
                        {
                        <a href="javascript:void(0);" class="anchorDetail" data-id="@project.CurrentPslmId">
                        <img src="/assets/images/icons/attachemnts_clip.png" alt="Icon" style="width: 31px; height: 29px; margin-right: 0px;">
                        </a>
                        }
                        </td> *@
                            <td>@project.ProjName</td>
                            <td>@project.StakeHolder</td>
                            <td>@project.FwdtoUser</td>
                            <td>@project.Comments</td>
                            <td>@project.DateTimeOfUpdate?.ToString("dd-MM-yyyy")</td>


                            @foreach (var th in ViewBag.stakeholders)
                            {
                                if (th.UnitName == Logins.Unit)
                                {
                                    dynamic query = ViewBag.queryes;

                                    dynamic statusForStakeholder = null;
                                    string buttonColor = "blue-button";

                                    if (query != null)

                                    {
                                        foreach (dynamic item in query)
                                        {
                                            if (item.StakeholderName == th.UnitName && item.ProjId == project.ProjId && item.PsmId == project.CurrentPslmId)
                                            {
                                                statusForStakeholder = item;

                                                break;
                                            }
                                        }

                                        if (statusForStakeholder != null)
                                        {
                                            var statusCodeForStakeholder = statusForStakeholder.StatusName;

                                            if (statusCodeForStakeholder == "Accepted")
                                            {
                                                buttonColor = "green-button";
                                            }
                                            else if (statusCodeForStakeholder == "Obsn & Rectification")
                                            {
                                                buttonColor = "yellow-button";
                                            }
                                            else if (statusCodeForStakeholder == "Rejected")
                                            {
                                                buttonColor = "red-button";
                                            }

                                            <td> @statusCodeForStakeholder </td>

                                        }

                                        else
                                        {
                                            <td> Pending </td>
                                        }



                                    }

                                    <td>
                                        @if(Logins.Role == Logins.Unit && Logins.unitid == 1)
                                        {
                                            <button type="button" class="btn @buttonColor table-readonly project-details-btn" data-bs-toggle="modal" data-bs-target="#UnitAdd" data-proj-id="@project.ProjId" data-psm-id="@project.CurrentPslmId" data-stakeholder-id="@th.unitid" data-stakeholder-name="@th.UnitName"
                                                    data-proj-namess="@project.ProjName" data-aim-scope="@project.AimScope" data-initiateddate="@project.InitiatedDate" data-req-justi="@project.ReqmtJustification" data-usabilityOf-appln="@project.InitialRemark" data-major-timeline="@project.FwdtoUser" data-namof-sponser="@project.IsWhitelisted" data-initiated-date="@project.InitiatedDate" data-initiated-by="@project.StakeHolder" data-hosttype="@project.Hostedon">
                                            </button>
                                        }
                                        else
                                        {
                                            <button type="button" class="btn @buttonColor table-button project-details-btn" data-bs-toggle="modal" data-bs-target="#UnitAdd" data-proj-id="@project.ProjId" data-psm-id="@project.CurrentPslmId" data-stakeholder-id="@th.unitid" data-stakeholder-name="@th.UnitName"
                                                    data-proj-namess="@project.ProjName" data-aim-scope="@project.AimScope" data-usabilityOf-appln="@project.InitialRemark" data-req-justi="@project.ReqmtJustification" data-major-timeline="@project.FwdtoUser" data-namof-sponser="@project.IsWhitelisted" data-initiated-date="@project.InitiatedDate" data-initiated-by="@project.StakeHolder" data-hosttype="@project.Hostedon">
                                            </button>
                                        }
                                    </td>

                                }
                            }


                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>
</div>


<!----END Table for Stakeholder Status Change----->


<script>
    $(document).ready(function () {
        $('.table-button').on('click', function () {
            var $button = $(this);
            var stakeHolderId = $button.data('stakeholder-id');
            var projId = $button.data('proj-id');
            var psmId = $button.data('psm-id');

            $('#StakeholdertextId').val(stakeHolderId);
            $('#ProjtextId').val(projId);
            $('#PsmToProj').val(psmId);

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetComments", "Home")',
                data: {
                    "PsmId": psmId,
                    "stakeholderId": stakeHolderId,
                    "ProjId": projId
                },
                //contentType: "application/json; charset=utf-8",
                //dataType: "json",
                success: function (data) {

                    var commentContainer = '';

                    for (var i = 0; i < data.length; i++) {
                        var date = new Date(data[i].date);
                        var formattedDate = ("0" + date.getDate()).slice(-2) + '-' + ("0" + (date.getMonth() + 1)).slice(-2) + '-' + date.getFullYear();

                        commentContainer += '<div class="comment-box" style="text-align: justify;">'; // Use text-align: justify for justified text
                        commentContainer += '<div class="comment-header">';
                        commentContainer += '<div>';
                        commentContainer += '<span style="font-family: Arial; font-weight: bold; color: #0793f7;">' + data[i].stakeholderName + '</span>';
                        commentContainer += '<span style="margin-left: 10px;" class="comment-meta">' + formattedDate + '</span>';
                        commentContainer += '</div>';
                        commentContainer += '<div>';
                        commentContainer += '<span class="comment-meta">' + data[i].statusName + '</span>';
                        commentContainer += '<span class="pdf-link">'; // Move the PDF link to the same line as status

                        if (data[i].state !== null) {

                            commentContainer += '<a href="/Home/WaterMark3?id=' + data[i].state + '" target="_blank">';
                            commentContainer += '&nbsp;&nbsp; &nbsp;&nbsp;<img src="/assets/images/icons/pdfimg.png" alt="PDF icon" style="width: 24px; height: 24px;">';
                            commentContainer += '</a>';
                        }


                        commentContainer += '</span>';
                        commentContainer += '</div>';
                        commentContainer += '</div>';
                        commentContainer += '<div class="comment-content">' + data[i].comments + '</div>';
                        commentContainer += '</div>';
                    }

                    commentContainer += '</div>'; // Close the container
                    $('#ChatBox').empty().html(commentContainer);
                    $('#AddStatusDetails').show();

                    // Hide IndexTable container
                    $('#IndexTableContainer').hide();

                    
                },
                error: function () {
                    alert('Error fetching comments.');
                }
            });
        });

        $('#AddStatusDetails').hide();

        $('#CancelUpdate').click(function () {
            $('#AddStatusDetails').hide();

            // Show IndexTable container
            $('#IndexTableContainer').show();
        });
      

    });
</script>




<script>
    $(document).ready(function () {
        $('.table-readonly').on('click', function () {
            var $button = $(this);
            var stakeHolderId = $button.data('stakeholder-id');
            var projId = $button.data('proj-id');
            var psmId = $button.data('psm-id');

            $('#StakeholdertextId').val(stakeHolderId);
            $('#ProjtextId').val(projId);
            $('#PsmToProj').val(psmId);

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetComments", "Home")',
                data: {
                    "PsmId": psmId,
                    "stakeholderId": stakeHolderId,
                    "ProjId": projId
                },
                success: function (data) {
                    var commentContainer = '';

                    for (var i = 0; i < data.length; i++) {
                        var date = new Date(data[i].date);
                        var formattedDate = ("0" + date.getDate()).slice(-2) + '-' + ("0" + (date.getMonth() + 1)).slice(-2) + '-' + date.getFullYear();

                        commentContainer += '<div class="comment-box" style="text-align: justify;">'; // Use text-align: justify for justified text
                        commentContainer += '<div class="comment-header">';
                        commentContainer += '<div>';
                        commentContainer += '<span style="font-family: Arial; font-weight: bold; color: #0793f7;">' + data[i].stakeholderName + '</span>';
                        commentContainer += '<span style="margin-left: 10px;" class="comment-meta">' + formattedDate + '</span>';
                        commentContainer += '</div>';
                        commentContainer += '<div>';
                        commentContainer += '<span class="comment-meta">' + data[i].statusName + '</span>';
                        commentContainer += '<span class="pdf-link">'; // Move the PDF link to the same line as status

                        if (data[i].state !== null) {
                            commentContainer += '<a href="/Home/WaterMark3?id=' + data[i].state + '" target="_blank">';
                            commentContainer += '&nbsp;&nbsp; &nbsp;&nbsp;<img src="/assets/images/icons/pdfimg.png" alt="PDF icon" style="width: 24px; height: 24px;">';
                            commentContainer += '</a>';
                        }

                        commentContainer += '</span>';
                        commentContainer += '</div>';
                        commentContainer += '</div>';
                        commentContainer += '<div class="comment-content">' + data[i].comments + '</div>';
                        commentContainer += '</div>';
                    }

                    $('#ChatBoxreadonly').empty().html(commentContainer);
                    $('#AddStatusDetReadonly').show();
                    $('#IndexTableContainer').hide();

                    
                },
                error: function () {
                    alert('Error fetching comments.');
                }
            });
        });

        $('#AddStatusDetReadonly').hide();

        $('#CancelUpdate1').click(function () {
            $('#AddStatusDetReadonly').hide();
            $('#IndexTableContainer').show();
        });

      
    });


</script>




<script>

    document.addEventListener('DOMContentLoaded', function () {
        var projectDetailsBtns = document.querySelectorAll('.project-details-btn');

        projectDetailsBtns.forEach(function (btn) {
            btn.addEventListener('click', function () {
                var projectDetailsDiv = document.getElementById('projectDetails');
                var projectDetailsDiv1 = document.getElementById('ProjDetails1');
                var projectDetailsDiv2 = document.getElementById('ProjDetails2');
                var projectreadDeatilsDiv = document.getElementById('projectreadDetails');
                var projectreadDetailsDiv1 = document.getElementById('ProjreadDetails1');
                var projectreadDetailsDiv2 = document.getElementById('ProjreadDetails2');

                // Get data from the clicked button
                var projName = btn.getAttribute('data-proj-namess') || '';
                var aimScope = btn.getAttribute('data-aim-scope') || '';
                var Initiateddate = btn.getAttribute('data-initiated-date') || '';
                var newbandwidth = btn.getAttribute('data-band-with') || '';
                var hostingtype = btn.getAttribute('data-hosting-type') || '';
                var reqjustification = btn.getAttribute('data-req-justi') || '';
                var conceptofsw = btn.getAttribute('data-concept-sw') || '';
                var initiatedBy = btn.getAttribute('data-initiated-by') || '';
                var hosttype = btn.getAttribute('data-hosttype') || '';

                // Update the content of the projectheading div
                projectDetailsDiv.innerHTML = `
                                        Proj Details
                                        <table class="new-proj-table" style=width: 100%;height: 150px;>
                                            <tr>
                                                <td style="color: black;">Proj Name</td>
                                                <td style="color: black;">${projName}</td>
                                            </tr>
                                            <tr>
                                                <td style="color: black;">Aim & Scope</td>
                                                        <td class="long-text" style="color: black;">${aimScope}</td>
                                            </tr>
                                            <tr>
                                                <td style="color: black;">Initiated Date</td>
                                                <td style="color: black;">${Initiateddate}</td>
                                            </tr>
                                            <!-- Add more rows as needed -->
                                        </table>
                                    `;

                projectDetailsDiv1.innerHTML = `
                                        Tech Details
                                        <table class="new-proj-table">
                                            <tr>
                                                <td style="color: black;">New Band With</td>
                                                <td style="color: black;">${newbandwidth}</td>
                                            </tr>
                                            <tr>
                                                <td style="color: black;">Hosting Type</td>
                                                <td style="color: black;">${hostingtype}</td>
                                            </tr>
                                            <tr>
                                                <td style="color: black;">Request Justification</td>
                                                        <td class="long-text" style="color: black;">${reqjustification}</td>
                                            </tr>
                                            <!-- Add more rows as needed -->
                                        </table>
                                    `;

                projectDetailsDiv2.innerHTML = `
                                        Other Details
                                        <table class="new-proj-table" style=width: 100%;height: 150px;>
                                            <tr>
                                                <td style="color: black;">Concept Of S/W</td>
                                                <td style="color: black;">${conceptofsw}</td>
                                            </tr>
                                            <tr>
                                                <td style="color: black;">Initiated By</td>
                                                <td style="color: black;">${initiatedBy}</td>
                                            </tr>
                                            <tr>
                                                <td style="color: black;">Host Type</td>
                                                <td style="color: black;">${hosttype}</td>
                                            </tr>
                                            <!-- Add more rows as needed -->
                                        </table>
                                    `;
                projectreadDeatilsDiv.innerHTML = `
                                                Proj Details
                                                <table class="new-proj-table" style=width: 100%;height: 150px;>
                                                    <tr>
                                                        <td style="color: black;">Proj Name</td>
                                                        <td style="color: black;">${projName}</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="color: black;">Aim & Scope</td>
                                                        <td class="long-text" style="color: black;">${aimScope}</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="color: black;">Initiated Date</td>
                                                        <td style="color: black;">${Initiateddate}</td>
                                                    </tr>
                                                    <!-- Add more rows as needed -->
                                                </table>
                                            `;

                projectreadDetailsDiv1.innerHTML = `
                                                Tech Details
                                                <div id="testforscroll">
                                                   <table class="new-proj-table">
                                                <tr>
                                                    <td style="color: black;">New Band With</td>
                                                    <td style="color: black;">${newbandwidth}</td>
                                                </tr>
                                                <tr>
                                                    <td style="color: black;">Hosting Type</td>
                                                    <td style="color: black;">${hostingtype}</td>
                                                </tr>
                                                <tr>
                                                    <td style="color: black;">Request Justification</td>
                                                            <td class="long-text" style="color: black;">${reqjustification}</td>
                                                </tr>
                                                <!-- Add more rows as needed -->
                                            </table>
                                                </div>
                                            `;

                projectreadDetailsDiv2.innerHTML = `
                                                Other Details
                                                <table class="new-proj-table" style=width: 100%;height: 150px;>
                                                    <tr>
                                                        <td style="color: black;">Concept Of S/W</td>
                                                        <td style="color: black;">${conceptofsw}</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="color: black;">Initiated By</td>
                                                        <td style="color: black;">${initiatedBy}</td>
                                                    </tr>
                                                    <tr>
                                                        <td style="color: black;">Host Type</td>
                                                        <td style="color: black;">${hosttype}</td>
                                                    </tr>
                                                    <!-- Add more rows as needed -->
                                                </table>
                                            `;
            });
        });
    });


</script>







<script>
    function handleStatusChange() {

        var selectedStatus = document.getElementById("ddlStatus").value;


        var fileInput = document.getElementById("uploadfile");

        //if (selectedStatus === "1") {
        //    fileInput.removeAttribute("disabled");
        //} else {
        //    fileInput.value = "";
        //    fileInput.setAttribute("disabled", "disabled");
        //}
    }
</script>

<script>

    const pdfFileInput = document.getElementById('uploadfile');

    pdfFileInput.addEventListener('change', function (event) {
        const file = event.target.files[0];

        if (file) {


            const maxSizeInBytes = 10 * 1024 * 1024;
            if (file.size > maxSizeInBytes) {
                $('#uploadButton').hide();
                pdfFileInput.value = '';
                Swal.fire({
                    title: 'File Size Exceeded',
                    text: 'Please select a file smaller than 10MB.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }

          
            const reader = new FileReader();
            reader.onloadend = function () {
                const bytes = new Uint8Array(reader.result);
                const pdfHeader = new Uint8Array([37, 80, 68, 70, 45]);
                const isPDF = compareArrays(bytes.slice(0, 5), pdfHeader);
                if (isPDF) {

                    console.log('PDF file is valid. Proceed with upload.');
                } else {
                    Swal.fire({
                        title: 'Invalid File ....!',
                        text: 'Invalid PDF file. Please select a valid PDF file.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });

                    pdfFileInput.value = ''; 
                }
            };


            reader.readAsArrayBuffer(file);
        }
    });

    function compareArrays(array1, array2) {
        if (array1.length !== array2.length) {
            return false;
        }
        for (let i = 0; i < array1.length; i++) {
            if (array1[i] !== array2[i]) {
                return false;
            }
        }
        return true;
    }
</script>




<script>
    @if (TempData.ContainsKey("SuccessMessage"))
    {
        <text>
            Swal.fire({
                title: 'Saved & Ready for Next Step',
                text: '@TempData["SuccessMessage"]',
                icon: 'success',
                confirmButtonText: 'OK'
            });

        </text>
        TempData.Remove("SuccessMessage");
    }
</script>



<script>
    @if (TempData.ContainsKey("FailureMessage"))
    {
        <text>
            Swal.fire({
                title: 'Something Went Wrong....!',
                text: '@TempData["FailureMessage"]',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        </text>
        TempData.Remove("FailureMessage");

    }
</script>
